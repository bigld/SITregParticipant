var odata;

var dtojerror = " ";
var datorerror = " ";
jQuery.sap.require("sap.ui.core.mvc.Controller");
jQuery.sap.require("sap.ca.ui.model.format.AmountFormat");
jQuery.sap.require("sap.m.TablePersoController");
jQuery.sap.require("sap.m.MessageBox");
jQuery.sap.require("sap.ui.model.Filter");
jQuery.sap.require("sap.ui.model.FilterOperator");
jQuery.sap.require("sap.ui.core.Fragment");
jQuery.sap.require("sap.ui.base.Event");
jQuery.sap.require("sap.ui.model.json.JSONModel");
var Srno = "";
sap.ui.core.mvc.Controller.extend("com.ril.track.view.Master", {
	_oCatalog: null,
	_oResourceBundle: null,

	onInit: function() {
		this._oView = this.getView();
		// var oItemTemplate = this.byId("columnListItem").clone();
		this._oComponent = sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this._oView));
		this._oResourceBundle = this._oComponent.getModel("i18n").getResourceBundle();
		this._oRouter = this._oComponent.getRouter();
		this._oCatalog = this.byId("catalogTable");

		var comp = this.getOwnerComponent();
		/*Srno = comp.getComponentData().startupParameters.context[0];
		tabKey = comp.getComponentData().startupParameters.context[1];
		track = comp.getComponentData().startupParameters.context[2];
		mtrack = comp.getComponentData().startupParameters.context[3];*/
		
	var 	Srno = "",
		tabKey = "",
		track = "ABAP",
		mtrack ="ABAP";
		
		this._initViewPropertiesModel();
		// if (srno) {
		this.getView().byId("__label1").setText("User ID");
		this.getView().byId("__label4").setText("Name");
		this.binddata();

		// }
	},

	binddata: function() {
		//var Srno = 159;
		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV";
		var filmodel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var path = "/TeamMemberDetSet(SrNo='" + Srno + "')";

		filmodel.read(path, null, null, false, function(
				OData) {
				odata = OData;
			},

			function(oError) {
				var err = $
					.parseJSON(oError.response.body);
				var msg = err.error.message.value;
				sap.m.MessageBox
					.show(
						msg, {
							icon: sap.m.MessageBox.Icon.ERROR,
							title: "Error",
							onClose: function() {
								this.onNavBackFS();
							}
						});
			}
		);
		this.getView().byId("__input11").addEventDelegate({
			onAfterRendering: function() {
				$(".sapMDP >input ").attr("readonly", "readonly");
			}
		});
		this.getView().byId("__input12").addEventDelegate({
			onAfterRendering: function() {
				$(".sapMDP >input ").attr("readonly", "readonly");
			}
		});

		if (Srno == "") {
			this.getView().byId("__input4").setEditable(true);
			this.getView().byId("__label4").setProperty("required", true);
			this.getView().byId("__input10").setEditable(true);
			this.getView().byId("__label10").setProperty("required", true);

			this.getView().byId("__input2").setValue("");
			this.getView().byId("__input2").setTooltip("");

			this.getView().byId("__input22").setValue("");
			this.getView().byId("__input22").setTooltip("");

			this.getView().byId("__input3").setValue("");
			this.getView().byId("__input3").setTooltip("");

			this.getView().byId("__input5").setValue("");
			this.getView().byId("__input5").setTooltip("");

			this.getView().byId("__input5").setValue("");
			this.getView().byId("__input5").setTooltip("");
			
			this.getView().byId("__input12").setVisible(false)

		} else {

			this.getView().byId("__label8").setProperty("required", true);
			this.getView().byId("__label6").setProperty("required", true);
			this.getView().byId("__labe7").setProperty("required", true);
			this.getView().byId("__label17").setProperty("required", true);
			this.getView().byId("__input10").setPlaceholder("");

			this.getView().byId("__input0").setValue(odata.SrNo);
			this.getView().byId("__input0").setEditable(false);
			this.getView().byId("__input1").setValue(odata.UserId);
			this.getView().byId("__input1").setEditable(false);

			this.getView().byId("__input2").removeAllCustomData();
			this.getView().byId("__input2").addCustomData(
				new sap.ui.core.CustomData({
					key: odata.Track,
					value: odata.TrackDesc
				}));
			//	this.getView().byId("__input2").setValue(odata.TrackDesc + " " + "(" + odata.Track + ")");
			//	this.getView().byId("__input2").setTooltip(odata.TrackDesc + " " + "(" + odata.Track + ")");
			this.getView().byId("__input2").setValue(this.F4Title(odata.TrackDesc, odata.Track));
			this.getView().byId("__input2").setTooltip(this.F4Title(odata.TrackDesc, odata.Track));

			this.getView().byId("__input22").setValue(odata.MtrackDesc + " " + "(" + odata.Mtrack + ")");
			this.byId("__input22").setTooltip(odata.MtrackDesc + " " + "(" + odata.Mtrack + ")");
			// this.getView().byId("__inputTD").setValue(odata.TrackDesc);

			this.getView().byId("__input3").removeAllCustomData();
			this.getView().byId("__input3").addCustomData(
				new sap.ui.core.CustomData({
					key: odata.SubTrack,
					value: odata.SubTrackDesc
				}));
			//	this.getView().byId("__input3").setValue(odata.SubTrackDesc + " " + "(" + odata.SubTrack + ")");
			//	this.byId("__input3").setTooltip(odata.SubTrackDesc + " " + "(" + odata.SubTrack + ")");

			this.getView().byId("__input3").setValue(this.F4Title(odata.SubTrackDesc, odata.SubTrack));
			this.byId("__input3").setTooltip(this.F4Title(odata.SubTrackDesc, odata.SubTrack));
			// this.getView().byId("__inputSTD").setValue(odata.SubtrackDesc);

			this.getView().byId("__input4").setValue(odata.Name);
			this.getView().byId("__input4").setEditable(false);

			this.getView().byId("__input5").removeAllCustomData();
			this.getView().byId("__input5").addCustomData(
				new sap.ui.core.CustomData({
					key: odata.Org,
					value: odata.OrgDesc
				}));
			//	this.getView().byId("__input5").setValue(odata.OrgDesc + " " + "(" + odata.Org + ")");
			this.getView().byId("__input5").setValue(this.F4Title(odata.OrgDesc, odata.Org));
			//	this.byId("__input5").setTooltip(odata.OrgDesc + " " + "(" + odata.Org + ")");
			this.byId("__input5").setTooltip(this.F4Title(odata.OrgDesc, odata.Org));

			// this.getView().byId("__input5").setValue(odata.Org);
			// this.getView().byId("__inputOD").setValue(odata.OrgDesc);
			this.getView().byId("__input6").setValue(odata.Mobile);
			this.getView().byId("__input7").setValue(odata.WorkNo+" - "+odata.Extn);
			this.getView().byId("__input8").setValue(odata.Email);
			this.getView().byId("__input9").setValue(odata.WorkStation);
			this.getView().byId("__input10").setValue(odata.Ecode);
			this.getView().byId("__input10").setEditable(false);
			if (odata.Status == "A")
				this.getView().byId("__input12").setVisible(false);
			else
				this.getView().byId("__input12").setVisible(true);

			if (odata.DOJ) {
				var dojy = odata.DOJ.getFullYear().toString();
				var dojm = (odata.DOJ.getMonth() + 1).toString();
				var dojd = odata.DOJ.getDate().toString();
				var dojf = dojy + "-" + (dojm[1] ? dojm : "0" + dojm[0]) + "-" + (dojd[1] ? dojd : "0" + dojd[0]);
				this.getView().byId("__input11").setValue(dojf);
			}

			if (odata.DOR) {
				var dory = odata.DOR.getFullYear().toString();
				var dorm = (odata.DOR.getMonth() + 1).toString();
				var dord = odata.DOR.getDate().toString();
				var dorf = dory + "-" + (dorm[1] ? dorm : "0" + dorm[0]) + "-" + (dord[1] ? dord : "0" + dord[0]);
				this.getView().byId("__input12").setValue(dorf);
			}

			this.getView().byId("__input13").setValue(odata.ReplaceSrNo);
			this.getView().byId("__input14").setValue(odata.Replacement);
			this.byId("__input14").setTooltip(odata.Replacement);
			this.getView().byId("__input15").setValue(odata.Experties);

			if (odata.InductionDate) {
				var indy = odata.InductionDate.getFullYear().toString();
				var indm = (odata.InductionDate.getMonth() + 1).toString();
				var indd = odata.InductionDate.getDate().toString();
				var indf = indy + "-" + (indm[1] ? indm : "0" + indm[0]) + "-" + (indd[1] ? indd : "0" + indd[0]);
				this.getView().byId("__input16").setValue(indf);
			}

			//   	var oview = this.getView();
			// var oModel = new sap.ui.model.json.JSONModel();
			// this.setModel(oModel);
			// var d = oview.byId("__form0").getModel().getData();
			// oview.byId("__input17").setSelectedKey(d.Status);

			this.getView().byId("__input17").removeAllCustomData();
			this.getView().byId("__input17").addCustomData(
				new sap.ui.core.CustomData({
					key: odata.Status,
					value: odata.StatusDesc
				}));
			this.getView().byId("__input17").setValue(this.F4Title(odata.StatusDesc, odata.Status));
			this.byId("__input17").setTooltip(this.F4Title(odata.StatusDesc, odata.Status));

			this.getView().byId("__input18").removeAllCustomData();
			this.getView().byId("__input18").addCustomData(
				new sap.ui.core.CustomData({
					key: odata.Category,
					value: odata.CategoryDesc
				}));
			this.getView().byId("__input18").setValue(this.F4Title(odata.CategoryDesc, odata.Category));
			this.byId("__input18").setTooltip(this.F4Title(odata.CategoryDesc, odata.Category));

			/*	if (odata.BusyTillDt) {
					var butily = odata.BusyTillDt.getFullYear().toString();
					var butilm = (odata.BusyTillDt.getMonth() + 1).toString();
					var butild = odata.BusyTillDt.getDate().toString();
					var butilf = butily + "-" + (butilm[1] ? butilm : "0" + butilm[0]) + "-" + (butild[1] ? butild : "0" + butild[0]);
					this.getView().byId("__input19").setValue(butilf);
				}

				if (odata.NewAllocationDt) {
					var ally = odata.NewAllocationDt.getFullYear().toString();
					var allm = (odata.NewAllocationDt.getMonth() + 1).toString();
					var alld = odata.NewAllocationDt.getDate().toString();
					var allf = ally + "-" + (allm[1] ? allm : "0" + allm[0]) + "-" + (alld[1] ? alld : "0" + alld[0]);
					this.getView().byId("__input20").setValue(allf);
				}*/
		}

	},
	F4Title: function(val1, val2) {
		if (val2 == "")
			return val1;
		else
			return val1 + " (" + val2 + ")";
	},

	onSavePress: function() {
		var Name = this.getView().byId("__input4").getValue();
		var EmpCode = this.getView().byId("__input10").getValue();
		var email = this.getView().byId("__input8").getValue();
		var mobile = this.getView().byId("__input6").getValue();
		var extn = this.getView().byId("__input7").getValue();
		var statuscode = this.getView().byId("__input17").getValue();

		if (!Srno) {
			if (!Name) {
				sap.m.MessageToast.show("Enter Name");
				this.getView().byId("__input4").setValueState("Error");
				return;
			}
			if (!EmpCode) {
				sap.m.MessageToast.show("Enter Employee Code");
				this.getView().byId("__input10").setValueState("Error");
				return;
			}
		} else {
			if (!email) {
				sap.m.MessageToast.show("Enter Email");
				this.getView().byId("__input8").setValueState("Error");
				return;
			} else if (email) {
				var mailregex = /^\w+[\w-+\.]*\@\w+([-\.]\w+)*\.[a-zA-Z]{2,}$/;
				if (!mailregex.test(email)) {
					sap.m.MessageToast.show("Enter valid Email", {
						icon: sap.m.MessageBox.Icon.ERROR,
						title: "Error"
					});
					this.getView().byId("__input8").setValueState("Error");
					return;
				} else {
					this.getView().byId("__input8").setValueState("None");
				}
			}
			if (!mobile) {
				sap.m.MessageToast.show("Enter Mobile Number");
				this.getView().byId("__input6").setValueState("Error");
				return;
			}
			if (!extn) {
				sap.m.MessageToast.show("Enter Extension ");
				this.getView().byId("__input7").setValueState("Error");
				return;
			}
			if (!statuscode) {
				sap.m.MessageToast.show("Enter Status of Developer");
				this.getView().byId("__input17").setValueState("Error");
				return;
			}
		}
		if (this.getView().byId("__input2").getValue())
			var track = this.getView().byId("__input2").getCustomData()[0].getKey();
		if (this.getView().byId("__input3").getValue())
			var subtrack = this.getView().byId("__input3").getCustomData()[0].getKey();
		if (this.getView().byId("__input5").getValue())
			var org = this.getView().byId("__input5").getCustomData()[0].getKey();
		if (this.getView().byId("__input17").getValue())
			var status = this.getView().byId("__input17").getCustomData()[0].getKey();
		if (this.getView().byId("__input18").getValue())
			var category = this.getView().byId("__input18").getCustomData()[0].getKey();

		var DtOfJoin = this.getView().byId("__input11").getDateValue();
		var RelDt = this.getView().byId("__input12").getDateValue();
		var workstation = this.getView().byId("__input9").getValue();

		if (dtojerror === " " && datorerror === " ") {
			var payload = {
				SrNo: Srno,
				//UserId: "",
				Mtrack: mtrack,
				Track: track,
				SubTrack: subtrack,
				Name: Name,
				Org: org,
				Mobile: mobile,
				Extn: extn,
				Email: email,
				WorkStation: workstation,
				Ecode: EmpCode,
				DOJ: DtOfJoin,
				DOR: RelDt,
				//ReplaceSrNo: "",
				//Replacement: "",
				//Experties: "",
				//InductionDate: "0000-00-00T00:00:00",
				Status: status,
				Category: category,
				//BusyTillDt: "0000-00-00T00:00:00",
				//NewAllocationDt: "0000-00-00T00:00:00"
			};

			var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV";
			var dModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
			var that=this;
			jQuery.sap.delayedCall(0, this, function() {
					dModel.create("/TeamMemberDetSet", payload, null, function(oData, oResponse) {
						// odata = oData;
						var msgS = JSON.parse(oResponse.headers['sap-message']).message;
						//var msgS = "Data has been updated.";
						sap.m.MessageBox.show(msgS, {
							icon: sap.m.MessageBox.Icon.SUCCESS,
							title: "Success",
							onClose: function() {
								if(Srno==""){
								that.getView().byId("__input4").setValue();
								that.getView().byId("__input10").setValue();
								that.getView().byId("__input8").setValue();
								that.getView().byId("__input6").setValue();
								that.getView().byId("__input7").setValue();
								that.getView().byId("__input17").setValue();
								that.getView().byId("__input2").setValue();
								that.getView().byId("__input3").setValue();
								that.getView().byId("__input5").setValue();
							//	that.getView().byId("__input17").setValue();
								that.getView().byId("__input18").setValue();
								that.getView().byId("__input11").setDateValue();
								that.getView().byId("__input12").setDateValue();
								that.getView().byId("__input9").setValue();
								
								that.getView().byId("__input4").setTooltip("Enter Name");
								that.getView().byId("__input10").setTooltip("Enter Employee Code");
								that.getView().byId("__input8").setTooltip("Enter Email");
								that.getView().byId("__input6").setTooltip("Enter Mobile Number");
								that.getView().byId("__input7").setTooltip("Enter Extension");
								that.getView().byId("__input17").setTooltip("Enter Status of Team Member");
								that.getView().byId("__input2").setTooltip("Enter Track");
								that.getView().byId("__input3").setTooltip("Enter Sub Track");
								that.getView().byId("__input5").setTooltip("Enter Organisation");
								that.getView().byId("__input18").setTooltip("Enter Status of Team Member");
								that.getView().byId("__input9").setTooltip("Enter Work Station");
								}
								else{
									that.onNavBack();
								}
							}
						});
					})
				},
				function(oError) {
					/*var eObject = $.parseJSON(oError.response.body);
					var eArray = eObject.error.innererror.errordetails;
					var msg = "";
					if (eArray.length === 0) {
						msg = eObject.error.message.value;
					} else {
						for (var i = 0; i < eArray.length; i++) {
							msg = msg + eArray[i].message + "\n";
						}
					}*/
					var msg = JSON.parse(oError.response.body).error.message.value;
					sap.m.MessageBox.show(msg, {
						icon: sap.m.MessageBox.Icon.ERROR,
						title: "Error",
						onClose: function() {}
					});
				}, true
			);
		} else {

			if (dtojerror === 1) {
				sap.m.MessageBox.show("Induction date must be greater than joining date!!!", {
					icon: sap.m.MessageBox.Icon.ERROR,
					title: "Error"
				});
				this.getView().byId("__input16").setValueState(sap.ui.core.ValueState.Error);
				return;
			}

			if (datorerror === 1) {
				sap.m.MessageBox.show("Release date must be greater than joining date!!!", {
					icon: sap.m.MessageBox.Icon.ERROR,
					title: "Error"
				});
				this.getView().byId("__input12").setValueState(sap.ui.core.ValueState.Error);
				return;
			}
		}
		// if(srno)
		// {
		//srno = this.getView().byId("__input0").getValue();

		// }
		//	var userid = this.getView().byId("__input1").getValue();

		/*var trackcode = this.getView().byId("__input2").getValue();
		var trkdesc = trackcode.split("(");
		var trkdesc1 = trkdesc[1].split(")");
		var track = trkdesc1[0];
		

		var mtrackcode = this.getView().byId("__input22").getValue();
		var mtrkdesc = mtrackcode.split("(");
		var mtrkdesc1 = mtrkdesc[1].split(")");
		var mtrack = mtrkdesc1[0];


		var subtrackcode = this.getView().byId("__input3").getValue();
		var subtrkdesc = subtrackcode.split("(");
		var subtrkdesc1 = subtrkdesc[1].split(")");
		var subtrack = subtrkdesc1[0];
        
		var name = this.getView().byId("__input4").getValue();

		var orgcode = this.getView().byId("__input5").getValue();
		var orgdesc = orgcode.split("(");
		var orgdesc1 = orgdesc[1].split(")");
		var org = orgdesc1[0];

		var mobile = this.getView().byId("__input6").getValue();
		var extn = this.getView().byId("__input7").getValue();
		var email = this.getView().byId("__input8").getValue();
		var workstation = this.getView().byId("__input9").getValue();
		var ecode = this.getView().byId("__input10").getValue();
		var doj = (this.byId("__input11").getValue().trim() && this.byId("__input11").getValue() + "T00:00:00") || null;
		var dor = (this.byId("__input12").getValue().trim() && this.byId("__input12").getValue() + "T00:00:00") || null;
		var replacesrno = this.getView().byId("__input13").getValue();
		var replacement = this.getView().byId("__input14").getValue();
		var experties = this.getView().byId("__input15").getValue();
		var inductiondate = (this.byId("__input16").getValue().trim() && this.byId("__input16").getValue() + "T00:00:00") || null;

		var statuscode = this.getView().byId("__input17").getValue();
		var statuscodedesc = statuscode.split("(");
		var statuscodedesc1 = statuscodedesc[1].split(")");
		var status = statuscodedesc1[0];
		

		var categorycode = this.getView().byId("__input18").getValue();
		var catcodedesc = categorycode.split("(");
		var catcodedesc1 = catcodedesc[1].split(")");
		var category = catcodedesc1[0];
	
		var busytilldt = (this.byId("__input19").getValue().trim() && this.byId("__input19").getValue() + "T00:00:00") || null;
		var newallocationdt = (this.byId("__input20").getValue().trim() && this.byId("__input20").getValue() + "T00:00:00") || null;*/

		/*	if (email) {
				var mailregex = /^\w+[\w-+\.]*\@\w+([-\.]\w+)*\.[a-zA-Z]{2,}$/;

				if (!mailregex.test(email)) {
					sap.m.MessageBox.show("Enter valid email ID!!!", {
						icon: sap.m.MessageBox.Icon.ERROR,
						title: "Error"
					});
					this.getView().byId("__input8").setValueState(sap.ui.core.ValueState.Error);
					return;
				} else {
					this.getView().byId("__input8").setValueState(sap.ui.core.ValueState.None);
				}
			}*/
		/*
				if (srno) {

				} else {
					if (userid === "") {

						sap.m.MessageBox.show("Please Enter User ID!!!", {
							icon: sap.m.MessageBox.Icon.ERROR,
							title: "Error"
						});
						this.getView().byId("__input1").setValueState(sap.ui.core.ValueState.Error);
						return;
					} else {
						this.getView().byId("__input1").setValueState(sap.ui.core.ValueState.None);
					}

					if (name === "") {

						sap.m.MessageBox.show("Please Enter Name!!!", {
							icon: sap.m.MessageBox.Icon.ERROR,
							title: "Error"
						});
						this.getView().byId("__input4").setValueState(sap.ui.core.ValueState.Error);
						return;
					} else {
						this.getView().byId("__input4").setValueState(sap.ui.core.ValueState.None);
					}
				}*/

		// var mtrack = this.getView().byId("__input22").getCustomData()[0].getKey();
	},

	handleDateInd: function(oEvent) {
		var dtoj = (this.byId("__input11").getValue().trim() && this.byId("__input11").getValue() + "T00:00:00") || null;
		var inddate = (this.byId("__input16").getValue().trim() && this.byId("__input16").getValue() + "T00:00:00") || null;
		if (inddate < dtoj) {
			dtojerror = 1;
			sap.m.MessageBox.show("Induction date must be greater than joining date!!!", {
				icon: sap.m.MessageBox.Icon.ERROR,
				title: "Error"
			});
			this.getView().byId("__input16").setValueState(sap.ui.core.ValueState.Error);
			return;
		} else {
			this.getView().byId("__input16").setValueState(sap.ui.core.ValueState.None);
			dtojerror = " ";
		}

	},

	handleDateRel: function(oEvent) {
		var datoj = (this.byId("__input11").getValue().trim() && this.byId("__input11").getValue() + "T00:00:00") || null;
		var dator = (this.byId("__input12").getValue().trim() && this.byId("__input12").getValue() + "T00:00:00") || null;
		if (dator < datoj) {
			datorerror = 1;
			sap.m.MessageBox.show("Release date must be greater than joining date!!!", {
				icon: sap.m.MessageBox.Icon.ERROR,
				title: "Error"
			});
			this.getView().byId("__input12").setValueState(sap.ui.core.ValueState.Error);
			return;
		} else {
			this.getView().byId("__input12").setValueState(sap.ui.core.ValueState.None);
			datorerror = " ";
		}
	},

	validateEmail: function(oEvent) {
		oEvent.getSource().setValueState("None");
		oEvent.getSource().setTooltip(oEvent.oSource.getValue());
		// // this.getView().byId("__input8").setValueState(sap.ui.core.ValueState.None);
		// var email = this.getView().byId("__input8").getValue();

		// var mailregex = /^\w+[\w-+\.]*\@\w+([-\.]\w+)*\.[a-zA-Z]{2,}$/;

		// if (!mailregex.test(email)) {

		// 	sap.m.MessageBox.show("Enter valid email ID!!!", {
		// 		icon: sap.m.MessageBox.Icon.ERROR,
		// 		title: "Error"
		// 	});

		// 	this.getView().byId("__input8").setValueState(sap.ui.core.ValueState.Error);

		// } 
		// else {
		//this.getView().byId("__input8").setValueState("None");
		// }
	},

	handleUserInput: function(oEvent) {
		oEvent.getSource().setValueState("None");
		oEvent.getSource().setTooltip(oEvent.oSource.getValue());;
	},

	handleNameInput: function(oEvent) {
		oEvent.getSource().setValueState("None");
		oEvent.getSource().setTooltip(oEvent.oSource.getValue());
	},

	handleValueHelpTrack: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Track",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selection,
				this
			],
			cancel: [
				this._handleValueHelpClose_selection,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{TrackDesc}",
			description: "{Track}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
	//	var spath = "/TrackListSet";
     var spath ="/TrackListSet/?$filter=Mtrack eq '"+ mtrack +"'";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},

	handleValueHelpMTrack: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Main Track",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selection,
				this
			],
			cancel: [
				this._handleValueHelpClose_selection,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{TrackDesc}",
			description: "{Track}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
		var spath = "/TrackListSet/?$filter=Mtrack eq '"+ mtrack +"'";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},

	handleValueHelpSubTrack: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Sub Track",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selection,
				this
			],
			cancel: [
				this._handleValueHelpClose_selection,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{SubTrackDesc}",
			description: "{SubTrack}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
		var spath = "/SubTrackListSet";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},

	handleValueHelpOrg: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Organisation",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selection,
				this
			],
			cancel: [
				this._handleValueHelpClose_selection,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{OrgDesc}",
			description: "{Org}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
		var spath = "/OrganisationListSet";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},

	handleValueHelpStatus: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Status",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selection,
				this
			],
			cancel: [
				this._handleValueHelpClose_selection,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{StatusDesc}",
			description: "{Status}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
		var spath = "/StatusListSet";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},

	handleValueHelpCat: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Category",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selection,
				this
			],
			cancel: [
				this._handleValueHelpClose_selection,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{CategoryDesc}",
			description: "{Category}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
		var spath = "/CategoryListSet";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},
	handleValueHelpReplace: function(oEvent) {
		this.inputId = oEvent.getSource().getId();
		this._valueHelpDialog_reason = new sap.m.SelectDialog({
			title: "Replacement",
			contentWidth: "250px",
			growingThreshold: 1500,
			liveChange: [
				this._handleValueHelpSearch_selection,
				this
			],
			search: [
				this._handleValueHelpSearch_selection,
				this
			],
			confirm: [
				this._handleValueHelpClose_selectionRep,
				this
			],
			cancel: [
				this._handleValueHelpClose_selectionRep,
				this
			]
		});

		var oItemTemplateE = new sap.m.StandardListItem({
			title: "{Name}",
			description: "{DevID}"
		});

		var sServiceUrl = "/sap/opu/odata/sap/Y_FIORI_ODATA_TEAM_MEM_MOD_SRV/";
		var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, true);
		var component;
		var spath = "/ReplacementSet";
		oModel
			.read(
				spath, {

					async: false,
					success: function(oData, response) {
						component = oData;

					}
				});
		var eModel = new sap.ui.model.json.JSONModel(component);

		// open value help dialog
		eModel.setSizeLimit(component.results.length);
		this._valueHelpDialog_reason.setModel(eModel);

		this._valueHelpDialog_reason.bindAggregation("items", "/results", oItemTemplateE);
		this._valueHelpDialog_reason.open();

		this._valueHelpDialog_reason.attachBrowserEvent(
			"keydown",
			function(Event) {
				if (Event.keyCode === 27) {
					Event.stopPropagation();
					Event.preventDefault();
				}
			});

	},
	_handleValueHelpSearch_selection: function(evt) {
		var sValue = evt.getParameter("value");
		sValue = sValue.toLowerCase();
		for (var i = 0; i < this._valueHelpDialog_reason.getItems().length; i++) {
			var val1 = this._valueHelpDialog_reason.getItems()[i].getTitle();
			val1 = val1.toLowerCase();

			var val2 = this._valueHelpDialog_reason.getItems()[i].getDescription();
			val2 = val2.toLowerCase();

			if (val1.indexOf(sValue) > -1 || val2.indexOf(sValue) > -1) {
				this._valueHelpDialog_reason.getItems()[i].setVisible(true);
			} else {
				this._valueHelpDialog_reason.getItems()[i].setVisible(false);
			}
		}

	},

	_handleValueHelpClose_selection: function(evt) {
		var oSelectedItem = evt.getParameter("selectedItem");
		/*	if (oSelectedItem) {
				var Input = this.getView().byId(this.inputId);
				// var InputDesc = this.getView().byId("__inputOD");
				// InputDesc.setValue(oSelectedItem.getDescription());
			this.MtrackDesc = oSelectedItem.getDescription();
				this.MtrackCode = oSelectedItem.getTitle(); 
				Input.setValue(this.MtrackDesc + "(" + this.MtrackCode + ")");
				this.byId(this.inputId).setTooltip(oSelectedItem.getTitle() + " " + "(" + oSelectedItem.getDescription() + ")");
			}*/

		if (oSelectedItem) {
			var Input = this.getView().byId(this.inputId);
			Input.removeAllCustomData();
			var desc = oSelectedItem.getTitle(),
				code = oSelectedItem.getDescription();
			Input.addCustomData(
				new sap.ui.core.CustomData({
					key: code,
					value: desc
				}));

			this.byId(this.inputId).setTooltip(desc + " (" + code + ")");
			this.byId(this.inputId).setValue(desc + " (" + code + ")");
		}
		evt.getSource().getBinding("items").filter([]);
	},

	_handleValueHelpClose_selectionRep: function(evt) {
		var oSelectedItem = evt.getParameter("selectedItem");
		if (oSelectedItem) {
			var Input = this.getView().byId(this.inputId);
			// var InputDesc = this.getView().byId("__inputOD");
			// InputDesc.setValue(oSelectedItem.getDescription());
			Input.setValue(oSelectedItem.getTitle());
			this.byId(this.inputId).setTooltip(
				oSelectedItem.getTitle() + " " + "(" + oSelectedItem.getDescription() + ")");
		}
		evt.getSource().getBinding("items").filter([]);
	},

	handleExtnInput: function(oEvent) {
		oEvent.oSource.setValueState("None");
		var extn = this.getView().byId("__input7").getValue();
		var tmpVal = extn.replace(/[^[0-9]/gi, '');
		oEvent.getSource().setValue(tmpVal);
	},

	handleMobileInput: function(oEvent) {
		oEvent.oSource.setValueState("None");
		var mobileno = this.getView().byId("__input6").getValue();
		var tmpVal = mobileno.replace(/[^[0-9]/gi, '');
		oEvent.getSource().setValue(tmpVal);
	},
	EmpCodePress: function(oEvent) {
		oEvent.oSource.setValueState("None");
		var s = oEvent.mParameters.newValue;
		s = s.replace(/[^a-zA-Z0-9]/gi, '');
		this.getView().byId("__input10").setValue(s);
	},
	WorkStnPress: function(oEvent) {
		oEvent.oSource.setValueState("None");
		var s = oEvent.mParameters.newValue;
		s = s.replace(/[^a-zA-Z0-9]/gi, '');
		this.getView().byId("__input9").setValue(s);
	},

	onAddRow: function(oEvent) {

		// var oTable = this.getView().byId("ItemTable");
		// oTable.addColumn(new sap.ui.table.Column(
		//       new sap.ui.commons.Label({
		// 		text: "LineItem"
		// 	}),
		// 	// sortProperty: "LineItem",
		// 	// filterProperty: "LineItem",
		// 	// width: "200px"
		// ));
		// oTable.addColumn(new sap.ui.table.Column({
		// 	label: new sap.ui.commons.Label({
		// 		text: "AccAss"
		// 	}),
		// 	sortProperty: "AccAss",
		// 	filterProperty: "AccAss",
		// 	width: "200px"
		// }));
		// oTable.addColumn(new sap.ui.table.Column({
		// 	label: new sap.ui.commons.Label({
		// 		text: "material"
		// 	}),
		// 	sortProperty: "material",
		// 	filterProperty: "material",
		// 	width: "200px"
		// }));

	},
	// The model created here is used to set values or view element properties that cannot be bound
	// directly to the OData service. Setting view element attributes by binding them to a model is preferable to the
	// alternative of getting each view element by its ID and setting the values directly because a JSon model is more
	// robust if the customer removes view elements (see extensibility).
	_initViewPropertiesModel: function() {
		var oViewElemProperties = {};
		oViewElemProperties.catalogTitleText = "TeamMemberDetSet";
		if (sap.ui.Device.system.phone) {
			oViewElemProperties.availabilityColumnWidth = "80%";
			oViewElemProperties.pictureColumnWidth = "5rem";
			oViewElemProperties.btnColHeaderVisible = true;
			oViewElemProperties.searchFieldWidth = "100%";
			oViewElemProperties.catalogTitleVisible = false;
			// in phone mode the spacer is removed in order to increase the size of the search field
			this.byId("tableToolbar").removeContent(this.byId("toolbarSpacer"));
		} else {
			oViewElemProperties.availabilityColumnWidth = "18%";
			oViewElemProperties.pictureColumnWidth = "9%";
			oViewElemProperties.btnColHeaderVisible = false;
			oViewElemProperties.searchFieldWidth = "30%";
			oViewElemProperties.catalogTitleVisible = true;
		}
		this._oViewProperties = new sap.ui.model.json.JSONModel(oViewElemProperties);
		this._oView.setModel(this._oViewProperties, "viewProperties");
	},

	/*	onNavBack: function() {
			window.history.go(-1);
			
		},*/
	onNavBack: function() {
		/*if (that_Master.commentsFragment != undefined) {
			that_Master.commentsFragment.destroy();
		}*/
		var navigationService = sap.ushell.Container.getService("CrossApplicationNavigation");
		navigationService.toExternal({
			target: {
				semanticObject: "ZABAP",
				action: "tracker",
			},
			//params :{ context : [tabKey] }
			params: {
				context: [Srno, tabKey, track]
			}
		});
		/*if (Srno == "") {
			window.history.go(-1);
		};*/

	},

	// --- List Handling

	// Handler method for the table search.
	onSearchPressed: function() {
		var sValue = this.byId("searchField").getValue();
		var oFilter = new sap.ui.model.Filter("SrNo",
			sap.ui.model.FilterOperator.Contains, sValue);
		var oBinding = this.byId("catalogTable").getBinding("items");
		oBinding.filter([oFilter]);
	},

	// --- Navigation
	onLineItemPressed: function(oEvent) {
		this._oRouter.navTo("details", {
			from: "main",
			entity: oEvent.getSource().getBindingContext().getPath().substr(1),
			tab: null
		});
	}

});